<html>
  <head>
    <script type="module" src="./web.bundle.min.js"></script>
    <script src="https://unpkg.com/arweave/bundles/web.bundle.min.js"></script>
    <style>
      /* Center the button */
      body {
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <div>
      <h1>Rates</h1>
      <span id="rates">Fetching rates...</span>
    </div>
    <div>
      <h1>Balance</h1>
      <span id="balance">Fetching balance for generated wallet...</span>
    </div>
    <script type="module">
      import { TurboFactory } from './web.bundle.min.js';

      // set up our factory
      const turbo = TurboFactory.init();

      // print the client to the console
      console.log(turbo);

      const rates = await turbo.getFiatRates();

      console.log(
        'Successfully fetched rates!',
        JSON.stringify(rates, null, 2),
      );

      // update the DOM
      const ratesString = Object.entries(rates['fiat'])
        .map(([key, value]) => {
          return `${key}: ${value}`;
        })
        .join('\n');
      document.getElementById('rates').innerText = ratesString;

      const arweave = Arweave.init();
      const jwk = await Arweave.crypto.generateJWK();
      const address = await arweave.wallets.jwkToAddress(jwk);
      const turboAuth = TurboFactory.init({ privateKey: jwk });
      const balance = await turboAuth.getBalance();
      document.getElementById('balance').innerText = JSON.stringify(
        balance,
        null,
        2,
      );
    </script>
  </body>
</html>
